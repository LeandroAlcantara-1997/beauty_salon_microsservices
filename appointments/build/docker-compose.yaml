version: '3.8'
services:
  appointment:
    user: vscode
    container_name: appointment
    build:
      context: ./../
      target: development
      dockerfile: build/Dockerfile
      args:
        # [Choice] Go version (use -bullseye variants on local arm64/Apple Silicon): 1, 1.16, 1.17, 1-bullseye, 1.16-bullseye, 1.17-bullseye, 1-buster, 1.16-buster, 1.17-buster
        VARIANT: "1.17-bullseye"
        NODE_VERSION: "none"
    volumes:
      - ..:/workspace
    ports:
      - "8080:8080"
    env_file:
      - ../env/application.env
    # Uncomment the next four lines if you will use a ptrace-based debugger like C++, Go, and Rust.
    cap_add:
      - SYS_PTRACE
    security_opt:
      - seccomp:unconfined
    # Overrides default command so things don't shut down after the process ends.
    command: /bin/sh -c "while sleep 1000; do :; done"
    # Runs app on the same network as the service container, allows "forwardPorts" in devcontainer.json function.
    depends_on:
      - mongo_db
      - rabbit
    networks:
      - appoint-network
      - queue-network

  mongo_db: 
    image: mongo:5.0
    container_name: mongo_db
    restart: always
    ports:
      - 27017:27017
    # volumes:
    #   - ../mongo:/data/db
    env_file:
      - ../env/application.env
    environment:
      - MONGO_INITDB_ROOT_USERNAME=${MONGO_USER}
      - MONGO_INITDB_ROOT_PASSWORD=${MONGO_PASSWORD}
    networks:
      - appoint-network

  redis:
    image: redis
    container_name: redis_memorydb
    command: redis-server --requirepass ${REDIS_PASSWORD}
    ports:
      - "6379:6379"
    networks:
      - appoint-network

networks:
  appoint-network:
    driver: bridge

volumes:
  go-scaffold-postgres: {}